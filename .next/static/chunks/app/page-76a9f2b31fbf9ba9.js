(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3210:(e,t,s)=>{Promise.resolve().then(s.bind(s,6902))},6902:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var a=s(5155),n=s(2115),r=s(5653);let l=r.z.enum(["Button","Card","Input","Table","Modal","Sidebar","Navbar","Chart"]),i=r.z.lazy(()=>r.z.object({id:r.z.string().min(1),component:l,props:r.z.record(r.z.unknown()),children:r.z.array(i).optional()})),o=r.z.object({mode:r.z.enum(["stack","grid","split"]),root:r.z.array(i).min(1),modificationInstructions:r.z.string().optional()}),c=r.z.object({label:r.z.string().min(1),variant:r.z.enum(["primary","secondary"]).optional()}).strict(),d=r.z.object({title:r.z.string().min(1)}).strict(),m=r.z.object({label:r.z.string().min(1),placeholder:r.z.string().optional(),value:r.z.string().optional()}).strict(),u=r.z.object({columns:r.z.array(r.z.string()),rows:r.z.array(r.z.array(r.z.string()))}).strict(),h=r.z.object({title:r.z.string().min(1),open:r.z.boolean()}).strict(),x=r.z.object({title:r.z.string().min(1),items:r.z.array(r.z.string())}).strict(),p={Button:c,Card:d,Input:m,Table:u,Modal:h,Sidebar:x,Navbar:r.z.object({title:r.z.string().min(1),links:r.z.array(r.z.string())}).strict(),Chart:r.z.object({title:r.z.string().min(1),data:r.z.array(r.z.object({label:r.z.string(),value:r.z.number()}).strict())}).strict()},f=new Set(["Card","Modal"]);function b(e){let{label:t,variant:s="primary",onClick:n}=e;return(0,a.jsx)("button",{type:"button",className:"primary"===s?"rounded-md bg-blue-700 px-3 py-2 text-sm font-semibold text-white hover:bg-blue-800":"rounded-md border border-slate-300 bg-white px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100",onClick:n,children:t})}function v(e){let{title:t,children:s}=e;return(0,a.jsxs)("section",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,a.jsx)("h3",{className:"mb-3 text-base font-semibold text-slate-900",children:t}),(0,a.jsx)("div",{className:"space-y-3",children:s})]})}function g(e){let{label:t,placeholder:s="",value:n=""}=e;return(0,a.jsxs)("label",{className:"block text-sm font-medium text-slate-700",children:[(0,a.jsx)("span",{className:"mb-1 block",children:t}),(0,a.jsx)("input",{readOnly:!0,value:n,placeholder:s,className:"w-full rounded-md border border-slate-300 px-3 py-2 text-sm text-slate-900"})]})}function j(e){let{columns:t,rows:s}=e;return(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg border border-slate-200",children:(0,a.jsxs)("table",{className:"w-full border-collapse text-left text-sm",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsx)("tr",{children:t.map(e=>(0,a.jsx)("th",{className:"border-b border-slate-200 px-3 py-2 font-semibold text-slate-700",children:e},e))})}),(0,a.jsx)("tbody",{children:s.map((e,t)=>(0,a.jsx)("tr",{className:"odd:bg-white even:bg-slate-50",children:e.map((e,s)=>(0,a.jsx)("td",{className:"border-b border-slate-200 px-3 py-2 text-slate-700",children:e},"".concat(t,"-").concat(s)))},"".concat(t,"-").concat(e.join("-"))))})]})})}function N(e){let{title:t,open:s,children:n}=e;return s?(0,a.jsxs)("div",{className:"rounded-xl border border-slate-300 bg-white p-4 shadow-lg",children:[(0,a.jsx)("h4",{className:"mb-2 text-base font-semibold text-slate-900",children:t}),(0,a.jsx)("div",{children:n})]}):null}function y(e){let{title:t,items:s}=e;return(0,a.jsxs)("aside",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[(0,a.jsx)("h4",{className:"mb-3 text-sm font-semibold uppercase tracking-wide text-slate-700",children:t}),(0,a.jsx)("ul",{className:"space-y-2 text-sm text-slate-700",children:s.map(e=>(0,a.jsx)("li",{className:"rounded-md px-2 py-1 hover:bg-slate-100",children:e},e))})]})}function w(e){let{title:t,links:s}=e;return(0,a.jsxs)("header",{className:"flex items-center justify-between rounded-xl border border-slate-200 bg-white px-4 py-3",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-slate-900",children:t}),(0,a.jsx)("nav",{className:"flex gap-3 text-sm text-slate-700",children:s.map(e=>(0,a.jsx)("span",{children:e},e))})]})}function k(e){let{title:t,data:s}=e,n=Math.max(...s.map(e=>e.value),1);return(0,a.jsxs)("section",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[(0,a.jsx)("h4",{className:"mb-3 text-sm font-semibold text-slate-900",children:t}),(0,a.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-[80px_1fr_40px] items-center gap-2 text-xs",children:[(0,a.jsx)("span",{className:"text-slate-600",children:e.label}),(0,a.jsx)("div",{className:"h-3 rounded bg-slate-200",children:(0,a.jsx)("div",{className:"h-3 rounded bg-blue-600 ".concat(function(e,t){let s=0===t?0:e/t;return s>=.9?"w-full":s>=.8?"w-5/6":s>=.7?"w-4/5":s>=.6?"w-3/4":s>=.5?"w-2/3":s>=.4?"w-1/2":s>=.3?"w-1/3":s>=.2?"w-1/4":"w-1/6"}(e.value,n))})}),(0,a.jsx)("span",{className:"text-right text-slate-700",children:e.value})]},e.label))})]})}function z(e){var t;let{plan:s}=e;return s?(0,a.jsx)("div",{className:"grid"===(t=s.mode)?"grid grid-cols-1 gap-4 md:grid-cols-2":"split"===t?"grid grid-cols-1 gap-4 lg:grid-cols-[250px_1fr]":"space-y-4",children:s.root.map(e=>(function e(t){var s;let n=(null!=(s=t.children)?s:[]).map(t=>e(t));switch(t.component){case"Button":return(0,a.jsx)(b,{...t.props},t.id);case"Card":return(0,a.jsx)(v,{...t.props,children:n},t.id);case"Input":return(0,a.jsx)(g,{...t.props},t.id);case"Table":return(0,a.jsx)(j,{...t.props},t.id);case"Modal":return(0,a.jsx)(N,{...t.props,children:n},t.id);case"Sidebar":return(0,a.jsx)(y,{...t.props},t.id);case"Navbar":return(0,a.jsx)(w,{...t.props},t.id);case"Chart":return(0,a.jsx)(k,{...t.props},t.id);default:return null}})(e))}):(0,a.jsx)("div",{className:"rounded-xl border border-dashed border-slate-300 bg-white p-6 text-sm text-slate-500",children:"Generate a UI from chat to see live preview."})}let S={generate:{welcome:"Hey there! Comment your thought and let's build a brand-new UI.",helper:"Generate creates a new UI from your request.",runLabel:"Generate UI",emptyError:"Please enter what UI you want to generate."},modify:{welcome:"Hey there! Describe what you want to change in the current UI.",helper:"Modify updates the selected version while preserving existing structure.",runLabel:"Apply Modification",emptyError:"Please describe what change you want to make."},regenerate:{welcome:"Hey there! Tell me what to rebuild from scratch.",helper:"Regenerate discards current context and builds from scratch.",runLabel:"Regenerate From Scratch",emptyError:"Please enter what you want regenerated from scratch."}};function C(){var e;let[t,s]=(0,n.useState)("dark"),[r,l]=(0,n.useState)("generate"),[i,c]=(0,n.useState)(S.generate.welcome),[d,m]=(0,n.useState)([]),[u,h]=(0,n.useState)(""),[x,b]=(0,n.useState)([]),[v,g]=(0,n.useState)(""),[j,N]=(0,n.useState)([]),[y,w]=(0,n.useState)([]),[k,C]=(0,n.useState)(""),[T,A]=(0,n.useState)(!1),[M,_]=(0,n.useState)(""),[O,U]=(0,n.useState)(""),[L,R]=(0,n.useState)(""),J=(0,n.useMemo)(()=>{var e;if(!u.trim())return null;let t=function(e){let t=e.match(/const\s+uiPlanJson\s*=\s*`([\s\S]*?)`;/);if(!(null==t?void 0:t[1]))return{valid:!1,error:"Could not find uiPlanJson in generated code"};try{let e=JSON.parse(t[1]),s=function(e){let t=o.safeParse(e);if(!t.success)return{valid:!1,error:t.error.flatten().formErrors.join("; ")||"Invalid plan schema"};let s=[];return(t.data.root.forEach((e,t)=>(function e(t,s,a){var n,r;p[t.component].safeParse(t.props).success||s.push("".concat(a,": invalid props for ").concat(t.component)),!f.has(t.component)&&(null==(n=t.children)?void 0:n.length)&&s.push("".concat(a,": ").concat(t.component," does not allow children")),(null!=(r=t.children)?r:[]).forEach((t,n)=>{e(t,s,"".concat(a,".children[").concat(n,"]"))})})(e,s,"root[".concat(t,"]"))),s.length)?{valid:!1,error:s.join("; ")}:{valid:!0,plan:t.data}}(e);if(!s.valid)return{valid:!1,error:s.error};return{valid:!0,plan:s.plan}}catch(e){return{valid:!1,error:"Invalid uiPlanJson payload"}}}(u);return t.valid&&null!=(e=t.plan)?e:null},[u]),D=(0,n.useMemo)(()=>{var e;return null!=(e=x.find(e=>e.id===M))?e:null},[x,M]),G=(0,n.useMemo)(()=>{var e,t,s,a;let n=null!=(s=null==(e=x.find(e=>e.id===O))?void 0:e.code)?s:"",r=null!=(a=null==(t=x.find(e=>e.id===L))?void 0:t.code)?a:"";return n&&r?function(e,t){let s=e.split("\n"),a=t.split("\n"),n=s.length,r=a.length,l=Array.from({length:n+1},()=>Array(r+1).fill(0));for(let e=n-1;e>=0;e-=1)for(let t=r-1;t>=0;t-=1)l[e][t]=s[e]===a[t]?l[e+1][t+1]+1:Math.max(l[e+1][t],l[e][t+1]);let i=[],o=0,c=0;for(;o<n&&c<r;)s[o]===a[c]?(i.push({kind:"same",text:s[o]}),o+=1,c+=1):l[o+1][c]>=l[o][c+1]?(i.push({kind:"removed",text:s[o]}),o+=1):(i.push({kind:"added",text:a[c]}),c+=1);for(;o<n;)i.push({kind:"removed",text:s[o]}),o+=1;for(;c<r;)i.push({kind:"added",text:a[c]}),c+=1;return i}(n,r):[]},[x,O,L]);function B(e){let t=S[r].welcome,s=""===i.trim()||i===t;l(e),s&&c(S[e].welcome)}async function H(e){let t=i.trim();if(t&&!T){if("modify"===e&&!M)return void m(e=>[...e,{role:"assistant",text:"No existing version selected to modify. Generate a UI first or select a version."}]);if(t===S[e].welcome)return void m(t=>[...t,{role:"assistant",text:S[e].emptyError}]);A(!0),C(""),w([]),m(e=>[...e,{role:"user",text:t}]);try{let a=await fetch("/api/agent?stream=1",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intent:t,action:e,baseVersionId:"modify"===e?M:void 0})});if(!a.ok||!a.body){let e=await a.text();m(t=>[...t,{role:"assistant",text:"Agent failed: ".concat(e)}]);return}let n=a.body.getReader(),r=new TextDecoder,l="";for(;;){var s;let e=await n.read();if(e.done)break;let t=(l+=r.decode(e.value,{stream:!0})).split("\n");for(let e of(l=null!=(s=t.pop())?s:"",t)){if(!e.trim())continue;let t=JSON.parse(e);"status"===t.type?w(e=>[...e,t.message]):"explanation_chunk"===t.type?C(e=>e+t.chunk):"final"===t.type?V({version:t.version,logs:t.logs,warnings:t.warnings}):"error"===t.type&&m(e=>[...e,{role:"assistant",text:"Agent failed: ".concat(t.error)}])}}}finally{A(!1)}}}function V(e){h(e.version.code),g(e.version.explanation),N(e.logs.map(e=>"[".concat(e.stage,"] ").concat(e.detail))),b(t=>[e.version,...t.filter(t=>t.id!==e.version.id)]),_(e.version.id),U(e.version.id),R(t=>t===e.version.id?"":t);let t=e.warnings.length?"Warnings: ".concat(e.warnings.join(" | ")):"";m(s=>[...s,{role:"assistant",text:"".concat(e.version.explanation).concat(t?"\n".concat(t):"")}])}async function q(){let e=await fetch("/api/versions");if(!e.ok)return;let t=await e.json();if(b(t.versions),t.versions.length&&!M){var s,a;_(t.versions[0].id),U(t.versions[0].id),R(null!=(a=null==(s=t.versions[1])?void 0:s.id)?a:""),h(t.versions[0].code),g(t.versions[0].explanation)}}async function F(e){let t=await fetch("/api/versions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(!t.ok)return;let s=await t.json();_(s.version.id),h(s.version.code),g(s.version.explanation),await q()}async function W(e){if(!T){A(!0);try{let t=await fetch("/api/agent/replay",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceVersionId:e})});if(!t.ok)return;let s=await t.json();V(s),w(t=>[...t,"Replay completed from ".concat(e)])}finally{A(!1)}}}return(0,n.useEffect)(()=>{let e=window.localStorage.getItem("ai-ui-builder-theme");("dark"===e||"light"===e)&&s(e)},[]),(0,n.useEffect)(()=>{document.documentElement.setAttribute("data-theme",t),window.localStorage.setItem("ai-ui-builder-theme",t)},[t]),(0,n.useEffect)(()=>{q()},[]),(0,a.jsxs)("main",{className:"h-screen p-3 md:p-4",children:[(0,a.jsxs)("header",{className:"app-header mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"app-title",children:"AI UI BUILDER"}),(0,a.jsx)("p",{className:"app-subtitle",children:"Deterministic interface generation and iterative UI editing"})]}),(0,a.jsx)("button",{className:"theme-toggle",onClick:()=>s("dark"===t?"light":"dark"),children:"dark"===t?"Light Theme":"Dark Theme"})]}),(0,a.jsxs)("div",{className:"grid h-[calc(100%-5.2rem)] grid-cols-1 gap-3 xl:grid-cols-[340px_1fr_460px]",children:[(0,a.jsxs)("section",{className:"panel flex min-h-0 flex-col",children:[(0,a.jsxs)("div",{className:"panel-heading",children:[(0,a.jsx)("h2",{className:"section-title",children:"Intent Chat"}),(0,a.jsx)("p",{className:"section-subtitle",children:"Streaming pipeline: Planner -> Generator -> Explainer"}),(0,a.jsx)("p",{className:"section-subtitle",children:S[r].helper})]}),(0,a.jsxs)("div",{className:"mb-3 flex gap-2",children:[(0,a.jsx)(I,{active:"generate"===r,onClick:()=>B("generate"),label:"Generate"}),(0,a.jsx)(I,{active:"modify"===r,onClick:()=>B("modify"),label:"Modify"}),(0,a.jsx)(I,{active:"regenerate"===r,onClick:()=>B("regenerate"),label:"Regenerate"})]}),(0,a.jsx)("textarea",{value:i,onChange:e=>c(e.target.value),className:"intent-input h-28",placeholder:S[r].welcome}),(0,a.jsx)("button",{className:"btn-primary mt-2",onClick:()=>H(r),disabled:T,children:T?"Running...":S[r].runLabel}),(0,a.jsxs)("div",{className:"surface-box mt-3",children:[(0,a.jsx)("div",{className:"surface-label",children:"Stream"}),(0,a.jsxs)("div",{className:"max-h-24 overflow-auto text-xs",children:[y.map((e,t)=>(0,a.jsxs)("div",{children:["- ",e]},t)),k&&(0,a.jsx)("pre",{className:"mt-2 whitespace-pre-wrap font-sans text-xs",children:k})]})]}),(0,a.jsx)("div",{className:"surface-box mt-3 min-h-0 flex-1 space-y-2 overflow-auto",children:d.map((e,t)=>(0,a.jsxs)("div",{className:"chat-bubble ".concat("user"===e.role?"chat-user":"chat-assistant"),children:[(0,a.jsx)("div",{className:"chat-role",children:e.role}),(0,a.jsx)("pre",{className:"whitespace-pre-wrap font-sans text-sm",children:e.text})]},t))})]}),(0,a.jsxs)("section",{className:"panel min-h-0",children:[(0,a.jsx)("h2",{className:"section-title mb-3",children:"Live Preview"}),(0,a.jsx)("div",{className:"surface-box h-[calc(100%-2rem)] overflow-auto p-4",children:(0,a.jsx)(z,{plan:J})})]}),(0,a.jsxs)("section",{className:"panel flex min-h-0 flex-col",children:[(0,a.jsx)("h2",{className:"section-title",children:"Code + Versions + Analysis"}),(0,a.jsx)("textarea",{value:u,onChange:e=>h(e.target.value),className:"code-input mt-3 h-48",placeholder:"Generated code appears here"}),(0,a.jsx)(E,{title:"Explanation",body:v}),(0,a.jsx)(E,{title:"Agent Logs",body:j.join("\n"),mono:!0}),(0,a.jsx)(P,{analysis:null!=(e=null==D?void 0:D.analysis)?e:null}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)("button",{className:"btn-ghost",onClick:q,children:"Refresh History"}),(0,a.jsxs)("select",{className:"select-input",value:O,onChange:e=>U(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Diff A"}),x.map(e=>(0,a.jsx)("option",{value:e.id,children:e.id},"a-".concat(e.id)))]}),(0,a.jsxs)("select",{className:"select-input",value:L,onChange:e=>R(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Diff B"}),x.map(e=>(0,a.jsx)("option",{value:e.id,children:e.id},"b-".concat(e.id)))]})]}),(0,a.jsx)("div",{className:"surface-box mt-2 max-h-28 overflow-auto font-mono text-[11px]",children:G.length?G.map((e,t)=>(0,a.jsxs)("div",{className:"added"===e.kind?"diff-add":"removed"===e.kind?"diff-remove":"diff-same",children:["added"===e.kind?"+":"removed"===e.kind?"-":" ",e.text]},"".concat(t,"-").concat(e.kind))):(0,a.jsx)("div",{className:"diff-same",children:"Select two versions to view diff."})}),(0,a.jsx)("div",{className:"mt-2 min-h-0 flex-1 space-y-2 overflow-auto",children:x.map(e=>(0,a.jsxs)("div",{className:"version-card ".concat(M===e.id?"version-active":""),children:[(0,a.jsxs)("button",{className:"w-full text-left",onClick:()=>{_(e.id),h(e.code),g(e.explanation)},children:[(0,a.jsx)("div",{className:"text-xs font-semibold",children:e.id}),(0,a.jsx)("div",{className:"text-[11px] opacity-80",children:new Date(e.createdAt).toLocaleString()}),(0,a.jsxs)("div",{className:"mt-1 text-xs",children:[e.action.toUpperCase()," | ",e.intent]})]}),(0,a.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,a.jsx)("button",{className:"btn-ghost text-xs",onClick:()=>F(e.id),children:"Rollback"}),(0,a.jsx)("button",{className:"btn-ghost text-xs",onClick:()=>W(e.id),children:"Replay"})]})]},e.id))})]})]})]})}function I(e){let{active:t,onClick:s,label:n}=e;return(0,a.jsx)("button",{className:"btn-mode ".concat(t?"btn-mode-active":""),onClick:s,children:n})}function E(e){let{title:t,body:s,mono:n}=e;return(0,a.jsxs)("div",{className:"surface-box mt-3 text-xs",children:[(0,a.jsx)("div",{className:"font-semibold",children:t}),(0,a.jsx)("pre",{className:"mt-1 whitespace-pre-wrap text-xs ".concat(n?"font-mono":"font-sans"),children:s})]})}function P(e){let{analysis:t}=e;return t?(0,a.jsxs)("div",{className:"surface-box mt-3 text-xs",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Static Analysis"}),(0,a.jsxs)("div",{className:"mt-1",children:["Score: ",(0,a.jsx)("span",{className:"font-semibold",children:t.score})," | Lines: ",t.metrics.lineCount," | JSX tags:"," ",t.metrics.jsxCount," | Imports: ",t.metrics.importCount]}),(0,a.jsx)("ul",{className:"mt-2 space-y-1",children:t.findings.map((e,t)=>(0,a.jsxs)("li",{className:"error"===e.level?"analysis-error":"warning"===e.level?"analysis-warning":"analysis-info",children:["[",e.level,"] ",e.code,": ",e.message]},"".concat(e.code,"-").concat(t)))})]}):(0,a.jsx)("div",{className:"surface-box mt-3 text-xs",children:"No static analysis yet."})}}},e=>{e.O(0,[653,441,255,358],()=>e(e.s=3210)),_N_E=e.O()}]);